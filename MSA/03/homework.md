# 03. Паттерны декомпозиции микросервисов

## 1. Выберите кейс. Кейс можно взять стандартный интернет-магазин или выбрать одну из архитектурных кат Нила Форда: https://nealford.com/katas/list.html

```diff
+Выбрал кейс [Architectural Katas]
```
Ссылка: [Architectural Katas](https://nealford.com/katas/kata?id=LightsPlease)

`Lights, Please`

A home electronics giant wants to build a system for home automation: turning lights on and off, locking and unlocking doors, remote camera observation, and future unspecified behavior.


**Users:**
each system will be sold to consumers (small families), but the company expects to sell thousands of these units in the first three years.

**Requirements:**
- the system must be as turnkey as possible, but be sold in modular units (camera, lock, thermostat, etc) for easy purchase
- the units must be accessible over the Internet (for remote monitoring and access), and it is assumed the user will have an existing WiFi setup (router and connection) to tap into
- customers can program the system to control the various modules according to their own needs.
- the electrical engineering for the units will be taken care of by other groups, and the software protocols for controlling the modules is flexible, according to the needs/designs of your architecture. (They will handle implementing the module side of the protocol, once you have specified it to them.)

**Additional Context:**
- willing to invest a large sum to get this new line of business off the ground
- collects data from customers who opt in to gather broader statistics
- international company

```diff
+В переводе:
```

`Свет, пожалуйста`

Гигант домашней электроники хочет создать систему домашней автоматизации: включать и выключать свет, запирать и отпирать двери, удаленное наблюдение с камеры и неопределенное поведение в будущем.
**Пользователи:**
каждая система будет продана потребителям (небольшим семьям), но компания рассчитывает продать тысячи таких устройств в течение первых трех лет.

**Требования:**
-	система должна быть максимально «под ключ», но продаваться в виде модульных блоков (камера, замок, термостат и т. д.) для удобства покупки
-	устройства должны быть доступны через Интернет (для удаленного мониторинга и доступа), и предполагается, что у пользователя будет существующая настройка Wi-Fi (маршрутизатор и соединение), чтобы подключиться к нему.
-	клиенты могут запрограммировать систему для управления различными модулями в соответствии со своими потребностями.
-	электротехникой блоков будут заниматься другие группы, а протоколы программного обеспечения для управления модулями являются гибкими в соответствии с потребностями/проектами вашей архитектуры. (Они займутся реализацией модульной части протокола, как только вы им это укажете.)

**Дополнительный контекст:**
-	готовы инвестировать крупную сумму, чтобы запустить это новое направление бизнеса.
-	собирает данные от клиентов, которые согласились собирать более широкую статистику
-	Международная компания



## 2. Для выбранного кейса используйте один из паттерных декомпозиций и предложите вариант разбиения на микросервисы.
В качестве решения предоставьте:
- Пользовательские сценарии в свободном формате.
- Общую схему взаимодействия сервисов в свободном формате.
- Для каждого сервиса опишите назначение сервиса и его зону ответственности в свободном формате.
- Опишите контракты взаимодействия сервисов друг с другом в свободном формате.


## Пользовательские сценарии в свободном формате.

```diff
+История: Настройка системы домашней автоматизации (СДА)
```

- `Как` пользователь СДА
- `Чтобы` настраивать СДА согласно своим предпочтениям
- `Я хочу` программировать связанное поведение модулей в СДА, управлять настройками каждого модуля в отдельности, управлять доступом к СДА.

|Сценарий|Описание|
|-|-|
|**Сценарий 1** | **Первоначальная настройка после покупки СДА**|
||`Есть` недавно приобретенная СДА (центральный модуль + вспомогательные модули: модуль управления светом + датчик открытия двери)|
||`И` аппаратные её части подключены в сеть моей домашней WiFi согласно инструкции.|
||`Когда` я первый раз захожу на web-страницу управления СДА (СУСДА)|
||`Тогда` я должен выбрать свой язык интерфейса|
||`И` указать свой собственный пароль для дальнейшего доступа к СУСДА|
||`И` указать, что к системе подключены два модуля: управление светом и датчик открытия двери|
||`И` увидеть, что СДА подтвердила наличие связи со всеми модулями|
|**Сценарий 2** |**Настройка отдельных модулей СДА**|
||`Дано`: преднастроенная СДА|
||`Когда` я захожу в СУСДА|
||`Тогда` я должен видеть список всех подключенных модулей|
||`И` должен видеть статусы модулей|
||`И` при клике по модулю «датчик открытия двери» открывается форма, где я указываю свой номер телефона для нотификации|
||`И` вижу кнопку включения/отключения модуля|
|**Сценарий 3** |**Программирование СДА**|
||`Дано`: преднастроенная СДА|
||`И` модуль управления светом|
||`И` датчик открытия двери|
||`Когда` я захожу в СУСДА|
||`И` захожу в раздел «Сценарии» |
||`Тогда` Я создаю новый сценарий и задаю ему своё название «Приход домой»|
||`И` указываю, что на первом шаге модуль «Датчик открытия двери» посылает событие «Дверь открылась»|
||`И` указываю, что на втором шаге включается модуль «Управление светом» |
||`И` указываю, что на третьем шаге включается ожидание 2 мин|
||`И` указываю, что на четвергом шаге выключается модуль «Управление светом» |

```diff
+История: Удаленное управление СДА
```

- `Как` пользователь СДА
- `Чтобы` управлять СДА
- `Я хочу` находясь вне дома управлять СДА и контролировать статус системы


|Сценарий|Описание|
|-|-|
|**Сценарий 1**| **Удаленное управление настройками СДА**|
||`Дано`: преднастроенная СДА|
||`И` ПК вне моего дома|
||`Когда` я захожу на СУСДА|
||`Тогда` я получаю полный доступ ко всем настройкам СДА, как если бы я находился в домашней сети WiFi|
|**Сценарий 2** |**Удаленное управление СДА**|
||`Дано`: преднастроенная СДА|
||`И` ПК вне моего дома|
||`Когда` я захожу на СУСДА|
||`Тогда` я кликаю по модулю «Управление светом», перехожу на форму модуля|
||`И` при нажатии на кнопку «включение света» – свет в доме загорается|



```diff
+История: Продвижение продаж СДА
```


- `Как` вендор СДА
- `Чтобы` привлекать новых клиентов 
- **И** стимулировать существующих клиентов к покупке доп. модулей;
- **И** продвигать продажи появляющихся новых модулей СДА на рынке
- `Я хочу` получать статистику от пользователей;
- **И** выводить пользователям информацию про доп. модули СДА


|Сценарий|Описание|
|-|-|
|**Сценарий 1**| **Настройка сбора статистики**|
||`Дано`: преднастроенная СДА или недавно приобретенная СДА|
||`Когда` пользователь заходит в СУСДА|
||`Тогда` запросить у пользователя разрешение на сбор статистики событий в СДА|
|**Сценарий 2** |**Сбор статистики**|
||`Дано`: преднастроенная СДА с включенным разрешением на сбор статистики событий в СДА|
||`Когда` происходит изменение статуса какого-либо модуля или возникает ошибка в системе|
||`Тогда` отправляется сообщение на сервер вендора|
|**Сценарий 3**| **Автоматическое обновление**|
||`Дано`: преднастроенная СДА|
||`Когда` пользователь входит в СУСДА|
||`Тогда` система автоматически проверяет обновления на сервере вендора|
||`И` предлагает пользователю установить обновления|
|**Сценарий 4** | **Предложение о покупке новых модулей** |
||`Дано`: преднастроенная СДА + модуль управления светом и нет модуля «датчик движения»|
||`Когда` пользователь входит в СУСДА|
||`Тогда` пользователь видит список всех подключенных модулей|
||`И` система выводит предложение приобрести модуль «датчик движения»|
||`И` пользователь при нажатии ссылку переходит на сайт вендора с предложением купить «датчик движения»|




## Общую схему взаимодействия сервисов в свободном формате.


## Для каждого сервиса опишите назначение сервиса и его зону ответственности в свободном формате.


## Опишите контракты взаимодействия сервисов друг с другом в свободном формате.


